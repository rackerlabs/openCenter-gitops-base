# Istio Gateway Hardened Configuration
# This file contains security-hardened settings for the Istio ingress gateway

# Number of replicas for high availability
replicaCount: 2

# Service configuration
service:
  type: LoadBalancer
  ports:
    - name: status-port
      port: 15021
      protocol: TCP
      targetPort: 15021
    - name: http2
      port: 80
      protocol: TCP
      targetPort: 80
    - name: https
      port: 443
      protocol: TCP
      targetPort: 443
  
  # Load balancer configuration
  loadBalancerIP: ""
  loadBalancerSourceRanges: []
  
  # External traffic policy
  externalTrafficPolicy: Local

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 2000m
    memory: 1024Mi

# Auto-scaling configuration
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Security context
securityContext:
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  fsGroup: 1337
  capabilities:
    drop:
      - ALL
    add:
      - NET_BIND_SERVICE

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "15020"
  prometheus.io/path: "/stats/prometheus"

# Service annotations (for cloud load balancers)
serviceAnnotations: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules for high availability
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - istio-ingress
          topologyKey: kubernetes.io/hostname

# Labels
labels:
  app: istio-ingress
  istio: ingress

# Environment variables
env: {}

# Network gateway configuration
networkGateway: ""
